# Raster

## Learning Objectives

In this lesson, you will learn:

- How to use the `raster` package to import geospatial data
- how to combine raster and vector to conduct geospatial analysis in `R`

## Introduction

We just have seen how to conduct spatial analysis in R using **vector** data. There is a second categories of geospatial data: **raster** data.

![](images/raster-vs-vector.png)


In a nutshell, raster data is a matrix of cells (or pixels) organized into rows and columns. Each cell / pixels stores a value. Satellite imagery, aerial imagery and radar from Earth Observation Systems are a great source of environmental data. 

![](images/raster-cell.png)

As discussed in the previous section, raster will have a Coordinate Reference System (CRS) defining the mathematical formula used to used to define the position of the raster pixels on earth. Few extra terms you might hear when talking about raster: 

- The **spatial resolution** of a raster refers to the size of a pixel. It is often defined as one number (e.g. 30m) assuming the pixels are squares; However it is not a requirement and pixels can be rectangular (have edges of different length).
- The **extent** of a raster refers to the area on Earth that is covered by the entire raster. It be defined in many ways, but it will often be defined using a specific corner, the pixel size, and the number of pixels along the x and y dimensions.
- The number of *bands* of a raster refers to a set of images over the same area but with value corresponding to different "bands" of the electromagnetic spectrum. For example, a typical RGB image will be made of 3: Red, Green, Blue. Often you want to stack those images to conduct an analysis as the area of observation matched perfectly. Satellite and other sensors can of course capture information far beyond the visible part of the electromagnetic spectrum.


![](images/rgb-stack.png)


### Raster File Formats

As vector data, raster data comes in various file formats:

#### `TIFF/GeoTIFF`

`TIFF/GeoTIFF` are probably the most common raster formats. GeoTIFFs consist of one file with a specific header that encapsulates the geospatial information. There is a second way to add geospatial information to a TIFF file by adding an extra "world" file `.tfw` with the same name as the TIFF file. This `.tfw` is a simple text file that defines various parameters to define the raster geospatial information.

#### `IMG`

This is a proprietary form from the remote sensing software ERDAS Imagine. It has the advantage to be able to store multiple bands in one file and also to have great compression capacity.

#### `NetCDF`

The Network Common Data Form, or netCDF, is an interface to a library of data access functions for storing and retrieving data in the form of arrays. A Subset of this format, the Hierarchical data format (HDF4 or HDF5), is a format that is often used by satellite imagery data providers. Through its great handling of multidimensional data, it can be used to store both space and time information.


One word on ESRI geospatial database storing raster data: it is unfortunately to sue R to read this data format. **R relies on [open source libraries](https://www.osgeo.org/choose-a-project/development/libraries/) to import and process geospatial data** (GDAL, GEOS, PROJ, ...), and ESRI has not yet opened this data format to those libraries.


## The `raster` Package

The raster package is THE package in R to import and process raster data. It can handle many of the formats mentioned above and more.

To import a raster in R, you will use the `raster` function for a single band raster. For multi-band raster, you can use the `brick()` function instead.

For this example, we are going to read a land cover map of Alaska from the The Multi-Resolution Land Characteristics ([MRLC](https://www.mrlc.gov)) consortium.

This file being quite large (~8GB), we have already downloaded it in a shared directory on the server. Let us read this raster into R.

```{r raster import}
library(raster)
# 
# lc <- raster("/home/shares/scientist/sasap-biophys/HabitatMetrics/Landcover2010/NA_NALCMS_LC_30m_3338_SASAP_clip.tif")
lc <- raster("/home/shares/scientist/ds-workshop/ak_nlcd_2011_landcover_1_15_15.img")

lc
```

```{r}
plot(lc)
```
Actually because the `img` format can handle categorical data and attach extra information, we can get the  colors as specified byt the data creator. Now we know it is a Land cover map, thus the color corraspog to a specific category. How can we fgure it out? 
1. seraching metadata from the data provider: https://www.mrlc.gov/data/legends/national-land-cover-database-2011-nlcd2011-legend
2. the raster object in R use a S4 formats that allows it to store specific information into slots. You can access thse slots using the `@`

```{r}
lc@data

```




```{r}
lc_3338 <- projectRaster(lc, crs=st_crs(ak_regions_3338), method = 'n)
```






## References


[Raster analysis in R](http://jafflerbach.github.io/spatial-analysis-R/intro_spatial_data_R.html) 


